<!DOCTYPE html>
<html>
    <head>
        <meta charset=utf-8>
        <title>My first Three.js app</title>
        <style>
            body { margin: 0; overflow: hidden; }
            canvas { width: 100%; height: 100% }

            #overlay {
                position:absolute;
                top:0;
                left:0;
                background-color: rgba(240,240,240,0.1);
                color: rgba(240,240,240,0.8);
            }
        </style>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

        <script src="js/three.min.js"></script>
        <script src="js/Detector.js"></script>
        <script src="js/OrbitControls.js"></script>
        <script src="js/Projector.js"></script>
        <script src="js/THREEx.KeyboardState.js"></script>

        <script src="js/TextGeometry.js"></script>
        <script src="js/FontUtils.js"></script>
        <script src="fonts/helvetiker_regular.typeface.js"></script>
    </head>
    <body>
        <div id="overlay">
            'F' Enable/Disable Floor
        </div>
        <script>
            ///////////
            // SCENE //
            ///////////
            scene = new THREE.Scene();

            projector = new THREE.Projector();
            mouseVector = new THREE.Vector3();
            raycaster = new THREE.Raycaster();


            ////////////
            // CAMERA //
            ////////////
            var SCREEN_WIDTH = window.innerWidth, SCREEN_HEIGHT = window.innerHeight;   
            var VIEW_ANGLE = 45,  ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT,  NEAR = 0.1,  FAR = 10000;
            camera = new THREE.PerspectiveCamera( VIEW_ANGLE, ASPECT, NEAR, FAR);
            scene.add(camera);
            //612.9606074763134, y: 405.56750761129473, z: 422.00389847204997
            camera.position.set(600,400,400);
            camera.lookAt(scene.position);  

            //////////////
            // RENDERER //
            //////////////
            if ( Detector.webgl )
                renderer = new THREE.WebGLRenderer( {antialias:true} );
            else
                renderer = new THREE.CanvasRenderer(); 

            renderer.setSize( window.innerWidth, window.innerHeight );
            document.body.appendChild( renderer.domElement );

            ////////////
            // LIGHTS //
            ////////////
            var light = new THREE.AmbientLight( 0xdddddd ); // soft white light
            scene.add( light );


            var pointLight = new THREE.PointLight(0xffffff, 1.0, 0.0, 1);
            pointLight.position.set(0,250,0);
            scene.add(pointLight);

            //////////////
            // KEYBOARD //
            //////////////
            var keyboard = new THREEx.KeyboardState();

            ////////////////////////
            // ORBITAL CONTROLLER //
            ////////////////////////
            var controls = new THREE.OrbitControls( camera, renderer.domElement );


            ////////////////
            // MAIN GROUP //
            ////////////////
            var group = new THREE.Group();



            
            var maxX = 3;
            var maxY = 3;
            var maxZ = 3;
            var distance = 50;
            var offset = distance + (distance/2.0);
            var deselctColor = 0x8888ff;
            var selectColor = 0x440000;
            var sphereGeometry = new THREE.SphereGeometry( 15, 15, 15 ); 
            for(var x=0;x<=maxX;x++) {
                for(var y=0;y<=maxY;y++) {
                    for(var z=0;z<=maxZ;z++) {
                        var sphereMaterial = new THREE.MeshLambertMaterial( {color: deselctColor} ); 
                        var sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
                        sphere.position.set((x*distance)-offset, (y*distance)-offset, (z*distance)-offset);
                        group.add(sphere);
                    }
                }
            }
            window.addEventListener( 'click', sphere_clicked, false );

            function sphere_clicked(e) {
                mouseVector.x = 2 * (e.clientX / SCREEN_WIDTH) - 1;
                mouseVector.y = 1 - 2 * ( e.clientY / SCREEN_HEIGHT );
                mouseVector.unproject( camera);
                raycaster.set( camera.position, mouseVector.sub( camera.position ).normalize() );
                var intersects = raycaster.intersectObjects( group.children );

                for( var i = 0; i < intersects.length; i++ ) {
                    var intersection = intersects[ i ],
                        obj = intersection.object;
                    if(obj.material.color.getHex() === deselctColor) 
                        obj.material.color.setHex(selectColor);
                    else 
                        obj.material.color.setHex(deselctColor);

                    break;
                }

            }

            //var raycaster = projector.pickingRay( mouseVector.clone(), camera );
            mouseVector.unproject( camera);
            raycaster.set( camera.position, mouseVector.sub( camera.position ).normalize() );
            var intersects = raycaster.intersectObjects( group.children );



            scene.add(group);



            ////////////////////////
            // CHECKERBOARD FLOOR //
            ////////////////////////
            var floorTexture = new THREE.ImageUtils.loadTexture( 'img/checkerboard.jpg' );
            floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping; 
            floorTexture.repeat.set( 10, 10 );
            var floorMaterial = new THREE.MeshLambertMaterial( { map: floorTexture, side: THREE.DoubleSide } );
            var floorGeometry = new THREE.PlaneGeometry(1000, 1000, 1, 1);
            var floor = new THREE.Mesh(floorGeometry, floorMaterial);
            //floor.position.y = -0.5;
            floor.rotation.x = Math.PI / 2;
            floor.visible = false;
            scene.add(floor);

            ////////////////////////
            // CREATE ENVIRONMENT //
            ////////////////////////
            function onWindowResize() {
                windowHalfX = window.innerWidth / 2;
                windowHalfY = window.innerHeight / 2;

                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();

                renderer.setSize( window.innerWidth, window.innerHeight );

            }
            function animate() {
                requestAnimationFrame( animate );
                render();       
                update();
            }

            var keyboard_f=true;
            function update() {
                if ( keyboard.pressed("f") && keyboard_f) {
                    keyboard_f = false;
                    if(floor.visible)
                        floor.visible = false;
                    else 
                        floor.visible = true;
                    setTimeout(function() {
                        keyboard_f = true;
                    }, 300);
                }
                controls.update();
            }

            function render() {   
                renderer.render( scene, camera );
            } 
            animate();
            window.addEventListener( 'resize', onWindowResize, false );
        </script>
    </body>
</html> 